From 378f19c86dea6a150ad35e51d9fed407cc8ea76f Mon Sep 17 00:00:00 2001
From: aniruddhgutta <aniruddhgutta@disroot.org>
Date: Sat, 18 Oct 2025 15:40:38 +0530
Subject: [PATCH 15/16] clang-implicitly-include-stdc-predef.h

---
 clang/lib/Driver/ToolChains/Clang.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/clang/lib/Driver/ToolChains/Clang.cpp b/clang/lib/Driver/ToolChains/Clang.cpp
index 626133223..47e6c8a4e 100644
--- a/clang/lib/Driver/ToolChains/Clang.cpp
+++ b/clang/lib/Driver/ToolChains/Clang.cpp
@@ -1004,6 +1004,16 @@ void Clang::AddPreprocessingOptions(Compilation &C, const JobAction &JA,
     }
   }
 
+  // Follow gcc in pre-including stdc-predef.h in non-freestanding mode
+  // Has to be done this early so that it comes before user-supplied -includes
+  if (!Args.hasArg(options::OPT_nostdinc) &&
+      !Args.hasArg(options::OPT_nostdlibinc) &&
+      !Args.hasArg(options::OPT_ffreestanding) &&
+      getToolChain().getTriple().isOSLinux()) {
+    CmdArgs.push_back("-include");
+    CmdArgs.push_back("stdc-predef.h");
+  }
+
   bool RenderedImplicitInclude = false;
   for (const Arg *A : Args.filtered(options::OPT_clang_i_Group)) {
     if (A->getOption().matches(options::OPT_include) &&
-- 
2.51.0

